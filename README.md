# alembic_demo

A very simple setup to help get started with Alembic. It was created as
follows:

1. Create and activate a Python virtual environment. 
2. `pip install alembic`
3. `alembic init alembic` to create the `alembic` folder and the Alembic
support files.
4. Edit `alembic.ini` to specify `sqlalchemy.url = sqlite:///demo.sqlite`
5. Create the `models` folder and files (`__base.py`, `__init__.py`,
`account.py`, and `invoice.py` )
6. Edit `alembic/env.py` to include `from models.__base import Base` (line 8)
and `target_metadata = Base.metadata` (line 19).

At this point we're ready to generate our initial migration. (Note that the
SQLite database will be created automatically the first time we try to access
it.) From a command prompt for your venv, run

```bash
alembic revision --autogenerate -m "Added account and invoice tables"
```

Check the resulting file in the `alembic/versions` folder. It will have a name
like

```text
31111b631f25_added_account_and_invoice_tables.py
```

The `upgrade` method should contain two `op.create_table()` and one
`op.create_index()` calls. 

```python
def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('account',
    sa.Column('account_number', sa.Integer(), nullable=False),
    sa.Column('customer_name', sa.String(length=50), nullable=True),
    sa.PrimaryKeyConstraint('account_number')
    )
    op.create_table('invoice',
    sa.Column('invoice_number', sa.Integer(), nullable=False),
    sa.Column('account_number', sa.Integer(), nullable=True),
    sa.Column('invoice_date', sa.Date(), nullable=True),
    sa.Column('invoice_amount', sa.Numeric(precision=18, scale=4), nullable=True),
    sa.ForeignKeyConstraint(['account_number'], ['account.account_number'], ),
    sa.PrimaryKeyConstraint('invoice_number')
    )
    op.create_index(op.f('ix_invoice_account_number'), 'invoice', ['account_number'], unique=False)
    # ### end Alembic commands ###
```

To actually create the tables in the SQLite database, do

```bash
alembic upgrade head
```
